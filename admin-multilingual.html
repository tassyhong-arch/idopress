<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹¤êµ­ì–´ ì½˜í…ì¸  ê´€ë¦¬ì - ì´ë„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nanum Gothic', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #f8fafc;
            color: #334155;
            line-height: 1.6;
        }

        .admin-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .admin-header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .admin-header p {
            opacity: 0.9;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .admin-nav {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            background: white;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            flex-wrap: wrap;
        }

        .nav-tab {
            background: #f1f5f9;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .nav-tab.active {
            background: #2563eb;
            color: white;
        }

        .nav-tab:hover:not(.active) {
            background: #e2e8f0;
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .tab-content.active {
            display: block;
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: #1e293b;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #374151;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-textarea {
            min-height: 150px;
            resize: vertical;
            font-family: 'Nanum Gothic', monospace;
        }

        .btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .btn:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #6b7280;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        .btn-success {
            background: #059669;
        }

        .btn-success:hover {
            background: #047857;
        }

        .btn-danger {
            background: #dc2626;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        .language-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .lang-btn {
            padding: 0.5rem 1rem;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .lang-btn.active {
            border-color: #2563eb;
            background: #2563eb;
            color: white;
        }

        .chapter-list {
            background: #f8fafc;
            border-radius: 8px;
            padding: 1rem;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }

        .chapter-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .chapter-item:last-child {
            border-bottom: none;
        }

        .chapter-item.active {
            background: #dbeafe;
            border-radius: 4px;
        }

        .progress-bar {
            background: #e5e7eb;
            height: 4px;
            border-radius: 2px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            background: #2563eb;
            height: 100%;
            transition: width 0.3s;
            width: 0%;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #2563eb;
        }

        .stat-label {
            color: #6b7280;
            font-size: 0.9rem;
        }

        .alert {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .two-column {
                grid-template-columns: 1fr;
            }
            
            .admin-nav {
                flex-direction: column;
            }
        }

        .preview-panel {
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .json-output {
            background: #1f2937;
            color: #f3f4f6;
            padding: 1rem;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 300px;
            overflow: auto;
        }
    </style>
</head>
<body>
    <div class="admin-header">
        <h1>ğŸŒ ë‹¤êµ­ì–´ ì½˜í…ì¸  ê´€ë¦¬ì</h1>
        <p>í•œêµ­ê³ ì „ë¬¸í•™ ì´ë¶ ë¦¬ë”ê¸° ë‹¤êµ­ì–´ ì½˜í…ì¸  ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
    </div>

    <div class="container">
        <!-- Navigation Tabs -->
        <div class="admin-nav">
            <button class="nav-tab active" onclick="showTab('content-editor')">ğŸ“ ì½˜í…ì¸  í¸ì§‘ê¸°</button>
            <button class="nav-tab" onclick="showTab('book-manager')">ğŸ“š ë„ì„œ ê´€ë¦¬</button>
            <button class="nav-tab" onclick="showTab('language-settings')">ğŸŒ ì–¸ì–´ ì„¤ì •</button>
            <button class="nav-tab" onclick="showTab('export-import')">ğŸ’¾ ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸°</button>
            <button class="nav-tab" onclick="showTab('preview')">ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</button>
        </div>

        <!-- Content Editor Tab -->
        <div id="content-editor-tab" class="tab-content active">
            <h2 class="section-title">ğŸ“ ë‹¤êµ­ì–´ ì½˜í…ì¸  í¸ì§‘ê¸°</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-books">4</div>
                    <div class="stat-label">ì´ ë„ì„œ ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-languages">4</div>
                    <div class="stat-label">ì§€ì› ì–¸ì–´</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-chapters">0</div>
                    <div class="stat-label">ì´ ì±•í„° ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completion-rate">0%</div>
                    <div class="stat-label">ë²ˆì—­ ì™„ë£Œìœ¨</div>
                </div>
            </div>

            <div class="two-column">
                <div>
                    <div class="form-group">
                        <label class="form-label">ë„ì„œ ì„ íƒ</label>
                        <select class="form-select" id="book-select" onchange="loadBookData()">
                            <option value="">ë„ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="chunhyang">ì¶˜í–¥ì „</option>
                            <option value="simcheong">ì‹¬ì²­ì „</option>
                            <option value="heungbu">í¥ë¶€ì „</option>
                            <option value="jusaeng">ì£¼ìƒì „</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ì–¸ì–´ ì„ íƒ</label>
                        <div class="language-selector">
                            <button class="lang-btn active" data-lang="korean" onclick="selectLanguage('korean')">ğŸ‡°ğŸ‡· í•œêµ­ì–´</button>
                            <button class="lang-btn" data-lang="english" onclick="selectLanguage('english')">ğŸ‡ºğŸ‡¸ English</button>
                            <button class="lang-btn" data-lang="spanish" onclick="selectLanguage('spanish')">ğŸ‡ªğŸ‡¸ EspaÃ±ol</button>
                            <button class="lang-btn" data-lang="japanese" onclick="selectLanguage('japanese')">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">ì±•í„° ëª©ë¡</label>
                        <div class="chapter-list" id="chapter-list">
                            <div class="alert-info alert">ë„ì„œë¥¼ ì„ íƒí•˜ë©´ ì±•í„° ëª©ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="form-group">
                        <label class="form-label">í˜„ì¬ ì±•í„°: <span id="current-chapter">ì„ íƒë˜ì§€ ì•ŠìŒ</span></label>
                        <input type="text" class="form-input" id="chapter-title" placeholder="ì±•í„° ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>

                    <div class="form-group">
                        <label class="form-label">ì±•í„° ë‚´ìš©</label>
                        <textarea class="form-textarea" id="chapter-content" placeholder="ì±•í„° ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”. ê° ë¬¸ë‹¨ì„ ìƒˆ ì¤„ë¡œ êµ¬ë¶„í•´ì£¼ì„¸ìš”." style="min-height: 300px;"></textarea>
                    </div>

                    <div class="form-group">
                        <button class="btn btn-success" onclick="saveChapter()">ğŸ’¾ ì±•í„° ì €ì¥</button>
                        <button class="btn btn-secondary" onclick="clearForm()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
                        <button class="btn" onclick="addNewChapter()">â• ìƒˆ ì±•í„° ì¶”ê°€</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Book Manager Tab -->
        <div id="book-manager-tab" class="tab-content">
            <h2 class="section-title">ğŸ“š ë„ì„œ ê´€ë¦¬</h2>
            
            <div class="form-group">
                <label class="form-label">ìƒˆ ë„ì„œ ì¶”ê°€</label>
                <input type="text" class="form-input" id="new-book-id" placeholder="ë„ì„œ ID (ì˜ë¬¸, ì†Œë¬¸ì)">
                <input type="text" class="form-input" id="new-book-title" placeholder="ë„ì„œ ì œëª©" style="margin-top: 0.5rem;">
                <input type="text" class="form-input" id="new-book-author" placeholder="ì €ì" style="margin-top: 0.5rem;">
                <textarea class="form-textarea" id="new-book-description" placeholder="ë„ì„œ ì„¤ëª…"></textarea>
                <button class="btn" onclick="createNewBook()">ğŸ“– ìƒˆ ë„ì„œ ìƒì„±</button>
            </div>

            <div class="alert-info alert">
                <strong>ğŸ’¡ íŒ:</strong> 
                ë„ì„œ IDëŠ” ì˜ë¬¸ ì†Œë¬¸ìë¡œë§Œ ì…ë ¥í•˜ì„¸ìš”. (ì˜ˆ: jusaeng, chunhyang)<br>
                ìƒˆ ë„ì„œë¥¼ ìƒì„±í•˜ë©´ ê¸°ë³¸ ì±•í„° êµ¬ì¡°ê°€ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤.
            </div>
        </div>

        <!-- Language Settings Tab -->
        <div id="language-settings-tab" class="tab-content">
            <h2 class="section-title">ğŸŒ ì–¸ì–´ ì„¤ì •</h2>
            
            <div class="alert-info alert">
                <strong>ì§€ì› ì–¸ì–´:</strong>
                <ul style="margin-top: 0.5rem;">
                    <li>ğŸ‡°ğŸ‡· í•œêµ­ì–´ (Korean) - ê¸°ë³¸ ì–¸ì–´</li>
                    <li>ğŸ‡ºğŸ‡¸ ì˜ì–´ (English)</li>
                    <li>ğŸ‡ªğŸ‡¸ ìŠ¤í˜ì¸ì–´ (EspaÃ±ol)</li>
                    <li>ğŸ‡¯ğŸ‡µ ì¼ë³¸ì–´ (æ—¥æœ¬èª)</li>
                </ul>
            </div>

            <div class="form-group">
                <label class="form-label">ë²ˆì—­ ì§„í–‰ ìƒí™©</label>
                <div id="translation-progress">
                    <!-- ë²ˆì—­ ì§„í–‰ë¥ ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <!-- Export/Import Tab -->
        <div id="export-import-tab" class="tab-content">
            <h2 class="section-title">ğŸ’¾ ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸°</h2>
            
            <div class="two-column">
                <div>
                    <h3>ğŸ“¤ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</h3>
                    <div class="form-group">
                        <label class="form-label">ë‚´ë³´ë‚¼ ë„ì„œ ì„ íƒ</label>
                        <select class="form-select" id="export-book-select">
                            <option value="">ë„ì„œ ì„ íƒ</option>
                            <option value="all">ëª¨ë“  ë„ì„œ</option>
                            <option value="chunhyang">ì¶˜í–¥ì „</option>
                            <option value="simcheong">ì‹¬ì²­ì „</option>
                            <option value="heungbu">í¥ë¶€ì „</option>
                            <option value="jusaeng">ì£¼ìƒì „</option>
                        </select>
                    </div>
                    <button class="btn" onclick="exportData()">ğŸ“¥ JSON íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°</button>
                </div>

                <div>
                    <h3>ğŸ“¥ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</h3>
                    <div class="form-group">
                        <label class="form-label">JSON íŒŒì¼ ì—…ë¡œë“œ</label>
                        <input type="file" class="form-input" id="import-file" accept=".json" onchange="importData()">
                    </div>
                    <div class="alert-info alert">
                        <strong>âš ï¸ ì£¼ì˜:</strong> ê¸°ì¡´ ë°ì´í„°ë¥¼ ë®ì–´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">JSON ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°</label>
                <div class="json-output" id="json-preview">
                    ë°ì´í„°ë¥¼ ë‚´ë³´ë‚´ê±°ë‚˜ ê°€ì ¸ì˜¤ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                </div>
            </div>
        </div>

        <!-- Preview Tab -->
        <div id="preview-tab" class="tab-content">
            <h2 class="section-title">ğŸ‘ï¸ ë¦¬ë”ê¸° ë¯¸ë¦¬ë³´ê¸°</h2>
            
            <div class="form-group">
                <label class="form-label">ë¯¸ë¦¬ë³´ê¸° ì„¤ì •</label>
                <select class="form-select" id="preview-book" onchange="updatePreview()">
                    <option value="">ë„ì„œ ì„ íƒ</option>
                    <option value="jusaeng">ì£¼ìƒì „</option>
                    <option value="chunhyang">ì¶˜í–¥ì „</option>
                    <option value="simcheong">ì‹¬ì²­ì „</option>
                    <option value="heungbu">í¥ë¶€ì „</option>
                </select>
            </div>

            <div class="preview-panel" id="preview-content">
                <div class="alert-info alert">ë„ì„œë¥¼ ì„ íƒí•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
            </div>

            <div class="form-group">
                <button class="btn" onclick="generateReaderFile()">ğŸš€ ë¦¬ë”ê¸° íŒŒì¼ ìƒì„±</button>
                <button class="btn btn-secondary" onclick="testReader()">ğŸ§ª ë¦¬ë”ê¸° í…ŒìŠ¤íŠ¸</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentBook = '';
        let currentLanguage = 'korean';
        let currentChapter = 1;
        let bookData = {
            chunhyang: {
                title: 'ì¶˜í–¥ì „',
                author: 'ì‘ì ë¯¸ìƒ',
                description: 'ì¡°ì„ ì‹œëŒ€ ë°°ê²½ì˜ ì˜ì›í•œ ì‚¬ë‘ ì´ì•¼ê¸°',
                languages: {
                    korean: { chapters: [] },
                    english: { chapters: [] },
                    spanish: { chapters: [] },
                    japanese: { chapters: [] }
                }
            },
            simcheong: {
                title: 'ì‹¬ì²­ì „',
                author: 'ì‘ì ë¯¸ìƒ',
                description: 'íš¨ë…€ ì‹¬ì²­ì´ì˜ ìˆ­ê³ í•œ íš¨ì‹¬ì„ ê·¸ë¦° ê°ë™ì ì¸ ì‘í’ˆ',
                languages: {
                    korean: { chapters: [] },
                    english: { chapters: [] },
                    spanish: { chapters: [] },
                    japanese: { chapters: [] }
                }
            },
            heungbu: {
                title: 'í¥ë¶€ì „',
                author: 'ì‘ì ë¯¸ìƒ',
                description: 'ì°©í•œ ë§ˆìŒì”¨ì˜ í¥ë¶€ì™€ ìš•ì‹¬ ë§ì€ ë†€ë¶€ì˜ ëŒ€ì¡°ë¥¼ í†µí•´ ì„ ì•…ì˜ êµí›ˆì„ ì „í•˜ëŠ” ì‘í’ˆ',
                languages: {
                    korean: { chapters: [] },
                    english: { chapters: [] },
                    spanish: { chapters: [] },
                    japanese: { chapters: [] }
                }
            },
            jusaeng: {
                title: 'ì£¼ìƒì „',
                author: 'ê¶Œí•„(æ¬ŠéŸ , 1569-1612)',
                description: 'ì¡°ì„  ì¤‘ê¸° ë¬¸ì¸ ê¶Œí•„ì´ ì§€ì€ ì¤‘êµ­ ì†Œì„¤',
                languages: {
                    korean: { chapters: [] },
                    english: { chapters: [] },
                    spanish: { chapters: [] },
                    japanese: { chapters: [] }
                }
            }
        };

        // Load data from localStorage
        function loadStoredData() {
            const stored = localStorage.getItem('idopress-admin-data');
            if (stored) {
                try {
                    bookData = JSON.parse(stored);
                } catch (e) {
                    console.error('ë°ì´í„° ë¡œë”© ì˜¤ë¥˜:', e);
                }
            }
            updateStats();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('idopress-admin-data', JSON.stringify(bookData));
            updateStats();
        }

        // Tab management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }

        // Language selection
        function selectLanguage(language) {
            currentLanguage = language;
            
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.querySelector(`[data-lang="${language}"]`).classList.add('active');
            
            if (currentBook) {
                loadChapterList();
                loadChapterContent();
            }
        }

        // Book selection
        function loadBookData() {
            currentBook = document.getElementById('book-select').value;
            
            if (!currentBook) {
                document.getElementById('chapter-list').innerHTML = 
                    '<div class="alert-info alert">ë„ì„œë¥¼ ì„ íƒí•˜ë©´ ì±•í„° ëª©ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤.</div>';
                clearForm();
                return;
            }

            loadChapterList();
            currentChapter = 1;
            loadChapterContent();
        }

        // Load chapter list
        function loadChapterList() {
            if (!currentBook || !currentLanguage) return;

            const chapters = bookData[currentBook].languages[currentLanguage].chapters;
            const listContainer = document.getElementById('chapter-list');

            if (chapters.length === 0) {
                listContainer.innerHTML = 
                    '<div class="alert-info alert">ì•„ì§ ì±•í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ìƒˆ ì±•í„°ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.</div>';
                return;
            }

            let html = '';
            chapters.forEach((chapter, index) => {
                const isActive = index + 1 === currentChapter ? 'active' : '';
                html += `
                    <div class="chapter-item ${isActive}" onclick="selectChapter(${index + 1})">
                        <span>ì œ${index + 1}ì¥: ${chapter.title || 'ì œëª© ì—†ìŒ'}</span>
                        <span>${chapter.content ? chapter.content.length : 0}ì</span>
                    </div>
                `;
            });

            listContainer.innerHTML = html;
        }

        // Select chapter
        function selectChapter(chapterNum) {
            currentChapter = chapterNum;
            loadChapterList();
            loadChapterContent();
        }

        // Load chapter content
        function loadChapterContent() {
            if (!currentBook || !currentLanguage) return;

            const chapters = bookData[currentBook].languages[currentLanguage].chapters;
            const chapter = chapters[currentChapter - 1];

            document.getElementById('current-chapter').textContent = 
                `${currentBook} - ${currentLanguage} - ì œ${currentChapter}ì¥`;

            if (chapter) {
                document.getElementById('chapter-title').value = chapter.title || '';
                document.getElementById('chapter-content').value = 
                    Array.isArray(chapter.content) ? chapter.content.join('\n\n') : chapter.content || '';
            } else {
                document.getElementById('chapter-title').value = '';
                document.getElementById('chapter-content').value = '';
            }
        }

        // Save chapter
        function saveChapter() {
            if (!currentBook || !currentLanguage) {
                alert('ë„ì„œì™€ ì–¸ì–´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const title = document.getElementById('chapter-title').value.trim();
            const content = document.getElementById('chapter-content').value.trim();

            if (!title || !content) {
                alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // Ensure chapters array exists
            if (!bookData[currentBook].languages[currentLanguage].chapters) {
                bookData[currentBook].languages[currentLanguage].chapters = [];
            }

            const chapters = bookData[currentBook].languages[currentLanguage].chapters;
            
            // Convert content to array of paragraphs
            const contentArray = content.split('\n\n').filter(p => p.trim());

            const chapterData = {
                number: currentChapter,
                title: title,
                content: contentArray
            };

            // Ensure array is large enough
            while (chapters.length < currentChapter) {
                chapters.push({
                    number: chapters.length + 1,
                    title: '',
                    content: []
                });
            }

            chapters[currentChapter - 1] = chapterData;
            
            saveData();
            loadChapterList();
            
            showAlert('success', `ì œ${currentChapter}ì¥ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`);
        }

        // Add new chapter
        function addNewChapter() {
            if (!currentBook || !currentLanguage) {
                alert('ë„ì„œì™€ ì–¸ì–´ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const chapters = bookData[currentBook].languages[currentLanguage].chapters;
            const newChapterNum = chapters.length + 1;

            chapters.push({
                number: newChapterNum,
                title: `ì œ${newChapterNum}ì¥`,
                content: []
            });

            currentChapter = newChapterNum;
            saveData();
            loadChapterList();
            loadChapterContent();

            showAlert('success', `ìƒˆ ì±•í„°(ì œ${newChapterNum}ì¥)ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`);
        }

        // Clear form
        function clearForm() {
            document.getElementById('chapter-title').value = '';
            document.getElementById('chapter-content').value = '';
            document.getElementById('current-chapter').textContent = 'ì„ íƒë˜ì§€ ì•ŠìŒ';
        }

        // Create new book
        function createNewBook() {
            const id = document.getElementById('new-book-id').value.trim().toLowerCase();
            const title = document.getElementById('new-book-title').value.trim();
            const author = document.getElementById('new-book-author').value.trim();
            const description = document.getElementById('new-book-description').value.trim();

            if (!id || !title || !author) {
                alert('ID, ì œëª©, ì €ìë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (bookData[id]) {
                alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë„ì„œ IDì…ë‹ˆë‹¤.');
                return;
            }

            bookData[id] = {
                title: title,
                author: author,
                description: description,
                languages: {
                    korean: { chapters: [] },
                    english: { chapters: [] },
                    spanish: { chapters: [] },
                    japanese: { chapters: [] }
                }
            };

            // Add to select options
            const bookSelect = document.getElementById('book-select');
            const option = document.createElement('option');
            option.value = id;
            option.textContent = title;
            bookSelect.appendChild(option);

            const exportSelect = document.getElementById('export-book-select');
            const exportOption = document.createElement('option');
            exportOption.value = id;
            exportOption.textContent = title;
            exportSelect.appendChild(exportOption);

            const previewSelect = document.getElementById('preview-book');
            const previewOption = document.createElement('option');
            previewOption.value = id;
            previewOption.textContent = title;
            previewSelect.appendChild(previewOption);

            // Clear form
            document.getElementById('new-book-id').value = '';
            document.getElementById('new-book-title').value = '';
            document.getElementById('new-book-author').value = '';
            document.getElementById('new-book-description').value = '';

            saveData();
            showAlert('success', `ìƒˆ ë„ì„œ "${title}"ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!`);
        }

        // Export data
        function exportData() {
            const bookId = document.getElementById('export-book-select').value;
            
            let exportData;
            if (bookId === 'all') {
                exportData = bookData;
            } else if (bookId && bookData[bookId]) {
                exportData = { [bookId]: bookData[bookId] };
            } else {
                alert('ë‚´ë³´ë‚¼ ë„ì„œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const jsonStr = JSON.stringify(exportData, null, 2);
            document.getElementById('json-preview').textContent = jsonStr;

            // Download file
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `idopress-${bookId === 'all' ? 'all-books' : bookId}-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showAlert('success', 'ë°ì´í„°ê°€ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤!');
        }

        // Import data
        function importData() {
            const fileInput = document.getElementById('import-file');
            const file = fileInput.files[0];

            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Merge with existing data
                    Object.assign(bookData, importedData);
                    
                    saveData();
                    loadStoredData();
                    
                    document.getElementById('json-preview').textContent = 
                        JSON.stringify(importedData, null, 2);
                    
                    showAlert('success', 'ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™€ì¡ŒìŠµë‹ˆë‹¤!');
                } catch (error) {
                    showAlert('error', 'íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            };

            reader.readAsText(file);
        }

        // Generate reader file
        function generateReaderFile() {
            const bookId = document.getElementById('preview-book').value;
            
            if (!bookId) {
                alert('ë¯¸ë¦¬ë³´ê¸°í•  ë„ì„œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const book = bookData[bookId];
            if (!book) {
                alert('ì„ íƒí•œ ë„ì„œì˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // Generate reader HTML content
            const readerData = {
                languages: {
                    korean: { name: 'í•œêµ­ì–´', code: 'ko' },
                    english: { name: 'English', code: 'en' },
                    spanish: { name: 'EspaÃ±ol', code: 'es' },
                    japanese: { name: 'æ—¥æœ¬èª', code: 'ja' }
                },
                chapters: book.languages
            };

            const jsonOutput = JSON.stringify(readerData, null, 2);
            document.getElementById('json-preview').textContent = jsonOutput;

            showAlert('success', `${book.title} ë¦¬ë”ê¸° ë°ì´í„°ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!`);
        }

        // Update statistics
        function updateStats() {
            let totalChapters = 0;
            let completedTranslations = 0;
            let totalTranslations = 0;

            Object.keys(bookData).forEach(bookId => {
                const book = bookData[bookId];
                Object.keys(book.languages).forEach(lang => {
                    const chapters = book.languages[lang].chapters || [];
                    totalChapters = Math.max(totalChapters, chapters.length);
                    totalTranslations++;
                    
                    if (chapters.length > 0 && chapters.some(ch => ch.content && ch.content.length > 0)) {
                        completedTranslations++;
                    }
                });
            });

            document.getElementById('total-books').textContent = Object.keys(bookData).length;
            document.getElementById('total-languages').textContent = 4;
            document.getElementById('total-chapters').textContent = totalChapters;
            document.getElementById('completion-rate').textContent = 
                totalTranslations > 0 ? Math.round((completedTranslations / totalTranslations) * 100) + '%' : '0%';
        }

        // Show alert
        function showAlert(type, message) {
            // Remove existing alerts
            document.querySelectorAll('.alert').forEach(alert => {
                if (alert.classList.contains('alert-success') || alert.classList.contains('alert-error')) {
                    alert.remove();
                }
            });

            const alert = document.createElement('div');
            alert.className = `alert alert-${type === 'success' ? 'success' : 'error'}`;
            alert.textContent = message;

            const container = document.querySelector('.tab-content.active');
            container.insertBefore(alert, container.firstChild);

            // Auto remove after 3 seconds
            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        // Update preview
        function updatePreview() {
            const bookId = document.getElementById('preview-book').value;
            const previewContainer = document.getElementById('preview-content');

            if (!bookId) {
                previewContainer.innerHTML = 
                    '<div class="alert-info alert">ë„ì„œë¥¼ ì„ íƒí•˜ë©´ ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>';
                return;
            }

            const book = bookData[bookId];
            let html = `<h3>${book.title}</h3><p><strong>ì €ì:</strong> ${book.author}</p><p>${book.description}</p><hr>`;

            // Show chapter preview for each language
            Object.keys(book.languages).forEach(lang => {
                const langName = {
                    korean: 'í•œêµ­ì–´', english: 'English', 
                    spanish: 'EspaÃ±ol', japanese: 'æ—¥æœ¬èª'
                }[lang];
                
                const chapters = book.languages[lang].chapters || [];
                html += `<h4>${langName} (${chapters.length}ê°œ ì±•í„°)</h4>`;
                
                if (chapters.length > 0) {
                    chapters.slice(0, 2).forEach((chapter, index) => {
                        html += `<p><strong>${chapter.title}</strong></p>`;
                        if (chapter.content && chapter.content.length > 0) {
                            const preview = Array.isArray(chapter.content) ? 
                                chapter.content[0] : chapter.content;
                            html += `<p>${preview.substring(0, 100)}...</p>`;
                        }
                    });
                } else {
                    html += '<p><em>ì•„ì§ ì±•í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</em></p>';
                }
                html += '<br>';
            });

            previewContainer.innerHTML = html;
        }

        // Test reader
        function testReader() {
            const bookId = document.getElementById('preview-book').value;
            
            if (!bookId) {
                alert('í…ŒìŠ¤íŠ¸í•  ë„ì„œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            // Open reader in new tab
            window.open(`read-${bookId}.html`, '_blank');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadStoredData();
            
            // Show initial stats
            updateStats();
        });
    </script>
</body>
</html>