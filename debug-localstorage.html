<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - LocalStorage ê²€ì‚¬</title>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .debug-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .debug-section h2 {
            color: #2563eb;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }
        
        .json-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-card h3 {
            margin: 0 0 10px 0;
            color: #1d4ed8;
        }
        
        .stat-card .value {
            font-size: 2rem;
            font-weight: bold;
            color: #2563eb;
        }
        
        .btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .btn:hover {
            background: #1d4ed8;
        }
        
        .btn-danger {
            background: #dc2626;
        }
        
        .btn-danger:hover {
            background: #b91c1c;
        }
    </style>
</head>
<body>
    <h1>ğŸ” LocalStorage ë””ë²„ê·¸ ë„êµ¬</h1>
    
    <div class="debug-section">
        <h2>ğŸ“Š í†µê³„ ì •ë³´</h2>
        <div class="stats">
            <div class="stat-card">
                <h3>ì „ì²´ ë„ì„œ</h3>
                <div class="value" id="totalBooks">0</div>
            </div>
            <div class="stat-card">
                <h3>ê¸°ë³¸ ë„ì„œ</h3>
                <div class="value">3</div>
            </div>
            <div class="stat-card">
                <h3>ì—…ë¡œë“œ ë„ì„œ</h3>
                <div class="value" id="uploadedBooks">0</div>
            </div>
            <div class="stat-card">
                <h3>LocalStorage í¬ê¸°</h3>
                <div class="value" id="storageSize">0 KB</div>
            </div>
        </div>
    </div>

    <div class="debug-section">
        <h2>ğŸ“š ì—…ë¡œë“œëœ ë„ì„œ ë°ì´í„° (Raw JSON)</h2>
        <button class="btn" onclick="refreshData()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        <button class="btn btn-danger" onclick="clearUploadedBooks()">ğŸ—‘ï¸ ì—…ë¡œë“œ ë„ì„œ ëª¨ë‘ ì‚­ì œ</button>
        <div class="json-display" id="rawData">ë°ì´í„°ë¥¼ ë¡œë”© ì¤‘...</div>
    </div>

    <div class="debug-section">
        <h2>ğŸ”§ ë„ì„œ êµ¬ì¡° ë¶„ì„</h2>
        <div id="bookAnalysis">ë¶„ì„ ì¤‘...</div>
    </div>

    <div class="debug-section">
        <h2>ğŸš¨ ì ì¬ì  ë¬¸ì œì </h2>
        <div id="issueAnalysis">ë¬¸ì œë¥¼ í™•ì¸í•˜ëŠ” ì¤‘...</div>
    </div>

    <script>
        // Default books for comparison
        const defaultBooks = [
            {
                id: 'chunhyang',
                title: 'ì¶˜í–¥ì „',
                author: 'ì‘ì ë¯¸ìƒ',
                emoji: 'ğŸŒ¸',
                description: 'ì‚¬ë‘ê³¼ ì˜ë¦¬ê°€ ë§Œë‚˜ëŠ” ì¡°ì„ ì‹œëŒ€ ìµœê³ ì˜ ë¡œë§¨ìŠ¤',
                url: 'read-chunhyang.html',
                type: 'default'
            },
            {
                id: 'simcheong',
                title: 'ì‹¬ì²­ì „',
                author: 'ì‘ì ë¯¸ìƒ', 
                emoji: 'ğŸŒŠ',
                description: 'íš¨ì‹¬ìœ¼ë¡œ ê°€ë“í•œ ë”¸ì˜ ê°ë™ì ì¸ í¬ìƒê³¼ ì‚¬ë‘',
                url: 'read-simcheong.html',
                type: 'default'
            },
            {
                id: 'heungbu',
                title: 'í¥ë¶€ì „',
                author: 'ì‘ì ë¯¸ìƒ',
                emoji: 'ğŸ ', 
                description: 'ì°©í•¨ê³¼ ìš•ì‹¬ì˜ ëŒ€ë¹„ë¡œ ë³´ëŠ” ì¸ìƒì˜ êµí›ˆ',
                url: 'read-heungbu.html',
                type: 'default'
            }
        ];

        function refreshData() {
            try {
                // Get raw localStorage data
                const rawUploadedBooks = localStorage.getItem('uploadedBooks');
                const uploadedBooksData = JSON.parse(rawUploadedBooks || '[]');
                
                // Update statistics
                document.getElementById('totalBooks').textContent = defaultBooks.length + uploadedBooksData.length;
                document.getElementById('uploadedBooks').textContent = uploadedBooksData.length;
                
                // Calculate storage size
                const storageSize = new Blob([rawUploadedBooks || '']).size;
                document.getElementById('storageSize').textContent = (storageSize / 1024).toFixed(1) + ' KB';
                
                // Display raw data
                document.getElementById('rawData').textContent = JSON.stringify(uploadedBooksData, null, 2);
                
                // Analyze book structure
                analyzeBookStructure(uploadedBooksData);
                
                // Check for issues
                checkForIssues(uploadedBooksData);
                
            } catch (error) {
                document.getElementById('rawData').textContent = 'ì˜¤ë¥˜: ' + error.message;
                console.error('Debug error:', error);
            }
        }
        
        function analyzeBookStructure(books) {
            let analysis = '<div style="font-family: monospace; font-size: 0.9rem;">';
            
            if (books.length === 0) {
                analysis += '<p style="color: #dc2626;">âŒ ì—…ë¡œë“œëœ ë„ì„œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            } else {
                books.forEach((book, index) => {
                    analysis += `<div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-left: 3px solid #2563eb;">`;
                    analysis += `<strong>ë„ì„œ ${index + 1}:</strong><br>`;
                    analysis += `â€¢ ID: ${book.id || 'âŒ ì—†ìŒ'}<br>`;
                    analysis += `â€¢ ì œëª©: ${book.title || 'âŒ ì—†ìŒ'}<br>`;
                    analysis += `â€¢ ì‘ê°€: ${book.author || 'âŒ ì—†ìŒ'}<br>`;
                    analysis += `â€¢ ì´ëª¨ì§€: ${book.emoji || 'âŒ ì—†ìŒ'}<br>`;
                    analysis += `â€¢ ì„¤ëª…: ${book.description ? (book.description.length > 50 ? book.description.substring(0, 50) + '...' : book.description) : 'âŒ ì—†ìŒ'}<br>`;
                    analysis += `â€¢ ë‚´ìš©: ${book.content ? 'âœ… ìˆìŒ (' + book.content.length + 'ì)' : 'âŒ ì—†ìŒ'}<br>`;
                    analysis += `â€¢ ë‹¤êµ­ì–´: ${book.multilingual ? 'âœ… ìˆìŒ' : 'âŒ ì—†ìŒ'}<br>`;
                    analysis += `â€¢ URL: ${book.url || 'âŒ ì—†ìŒ'}<br>`;
                    analysis += `â€¢ íƒ€ì…: ${book.type || 'âŒ ì—†ìŒ'}<br>`;
                    analysis += `</div>`;
                });
            }
            
            analysis += '</div>';
            document.getElementById('bookAnalysis').innerHTML = analysis;
        }
        
        function checkForIssues(books) {
            let issues = [];
            
            if (books.length === 0) {
                issues.push('ì—…ë¡œë“œëœ ë„ì„œê°€ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ë„ì„œë¥¼ ì—…ë¡œë“œí•´ë³´ì„¸ìš”.');
            }
            
            books.forEach((book, index) => {
                if (!book.id) {
                    issues.push(`ë„ì„œ ${index + 1}: IDê°€ ì—†ìŠµë‹ˆë‹¤.`);
                }
                if (!book.title) {
                    issues.push(`ë„ì„œ ${index + 1}: ì œëª©ì´ ì—†ìŠµë‹ˆë‹¤.`);
                }
                if (!book.author) {
                    issues.push(`ë„ì„œ ${index + 1}: ì‘ê°€ê°€ ì—†ìŠµë‹ˆë‹¤.`);
                }
                if (!book.content && !book.url) {
                    issues.push(`ë„ì„œ ${index + 1}: ë‚´ìš©ë„ ì—†ê³  URLë„ ì—†ìŠµë‹ˆë‹¤.`);
                }
                if (!book.type) {
                    issues.push(`ë„ì„œ ${index + 1}: íƒ€ì…ì´ ì§€ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`);
                }
            });
            
            let issuesHtml = '';
            if (issues.length === 0) {
                issuesHtml = '<p style="color: #16a34a;">âœ… ë°œê²¬ëœ ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤!</p>';
            } else {
                issuesHtml = '<ul>';
                issues.forEach(issue => {
                    issuesHtml += `<li style="color: #dc2626; margin: 5px 0;">âŒ ${issue}</li>`;
                });
                issuesHtml += '</ul>';
            }
            
            document.getElementById('issueAnalysis').innerHTML = issuesHtml;
        }
        
        function clearUploadedBooks() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ì—…ë¡œë“œëœ ë„ì„œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem('uploadedBooks');
                alert('ëª¨ë“  ì—…ë¡œë“œëœ ë„ì„œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                refreshData();
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', refreshData);
    </script>
</body>
</html>