<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ë„ - ê°œì„ ëœ ì´ë¶ ë¦¬ë”</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
            background: #f8f9fa;
            overflow: hidden;
            height: 100vh;
        }

        /* ë¦¬ë” ì»¨í…Œì´ë„ˆ */
        .reader-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: white;
        }

        /* ìƒë‹¨ í—¤ë” */
        .reader-header {
            background: white;
            border-bottom: 1px solid #e9ecef;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .book-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2563eb;
            max-width: 50%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .header-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .control-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 0.4rem 0.8rem;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .control-btn:hover {
            background: #e9ecef;
        }

        .control-btn.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }

        /* ë©”ì¸ ì½ê¸° ì˜ì—­ */
        .reading-area {
            flex: 1;
            display: flex;
            position: relative;
            overflow: hidden;
        }

        /* ë‹¨ì¼ í˜ì´ì§€ ëª¨ë“œ */
        .single-page-mode .page-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem 3rem;
            overflow-y: auto;
            height: 100%;
        }

        /* ì´ì¤‘ í˜ì´ì§€ ëª¨ë“œ */
        .double-page-mode .page-container {
            width: 50%;
            padding: 2rem;
            overflow-y: auto;
            height: 100%;
            border-right: 1px solid #e9ecef;
        }

        .double-page-mode .page-container:last-child {
            border-right: none;
        }

        /* í…ìŠ¤íŠ¸ ì½˜í…ì¸  */
        .page-content {
            line-height: var(--line-height, 1.8);
            font-size: var(--font-size, 16px);
            color: #374151;
            word-break: keep-all;
            overflow-wrap: break-word;
        }

        .page-content p {
            margin-bottom: 1.5em;
            text-align: justify;
        }

        /* ëª¨ë°”ì¼ ìµœì í™” */
        @media (max-width: 768px) {
            .reader-header {
                padding: 0.8rem 1rem;
            }

            .book-title {
                font-size: 1rem;
                max-width: 60%;
            }

            .header-controls {
                gap: 0.3rem;
            }

            .control-btn {
                padding: 0.3rem 0.6rem;
                font-size: 0.8rem;
            }

            /* ëª¨ë°”ì¼ì—ì„œëŠ” í•­ìƒ ë‹¨ì¼ í˜ì´ì§€ */
            .reading-area {
                flex-direction: column;
            }

            .page-container {
                width: 100% !important;
                padding: 1.5rem 1rem !important;
                border-right: none !important;
            }

            .double-page-btn {
                display: none;
            }
        }

        /* ì„¤ì • íŒ¨ë„ */
        .settings-panel {
            position: fixed;
            top: 0;
            right: -350px;
            width: 350px;
            height: 100vh;
            background: white;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            z-index: 2000;
            overflow-y: auto;
        }

        .settings-panel.open {
            right: 0;
        }

        .settings-content {
            padding: 2rem;
        }

        .settings-section {
            margin-bottom: 2rem;
        }

        .settings-section h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: #374151;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 0.5rem;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .setting-slider {
            width: 120px;
        }

        .theme-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .theme-btn {
            width: 40px;
            height: 30px;
            border: 2px solid #dee2e6;
            border-radius: 4px;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .theme-btn.active {
            border-color: #2563eb;
        }

        .theme-light { background: #ffffff; }
        .theme-sepia { background: #f4f1ea; }
        .theme-dark { background: #1a202c; }

        /* í…Œë§ˆë³„ ìŠ¤íƒ€ì¼ */
        .theme-light {
            background: #ffffff;
            color: #374151;
        }

        .theme-sepia {
            background: #f4f1ea;
            color: #4a3728;
        }

        .theme-sepia .page-content {
            color: #4a3728;
        }

        .theme-dark {
            background: #1a202c;
            color: #e2e8f0;
        }

        .theme-dark .reader-header {
            background: #2d3748;
            border-bottom-color: #4a5568;
        }

        .theme-dark .page-content {
            color: #e2e8f0;
        }

        .theme-dark .page-container {
            border-right-color: #4a5568;
        }

        /* ì§„í–‰ í‘œì‹œì¤„ */
        .progress-bar {
            height: 3px;
            background: #e9ecef;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: #2563eb;
            transition: width 0.3s;
            width: 0%;
        }

        /* ë¡œë”© ìƒíƒœ */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            font-size: 1.1rem;
            color: #6b7280;
        }

        /* ì—ëŸ¬ ìƒíƒœ */
        .error {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            padding: 2rem;
            text-align: center;
        }

        .error h3 {
            color: #dc2626;
            margin-bottom: 1rem;
        }

        .error p {
            color: #6b7280;
            margin-bottom: 2rem;
        }

        .error button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ í™”ì‚´í‘œ */
        .nav-arrow {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(37, 99, 235, 0.8);
            color: white;
            border: none;
            width: 50px;
            height: 80px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.5rem;
            z-index: 100;
            transition: background 0.2s;
            display: none;
        }

        .nav-arrow:hover {
            background: rgba(37, 99, 235, 1);
        }

        .nav-arrow.prev {
            left: 20px;
        }

        .nav-arrow.next {
            right: 20px;
        }

        @media (min-width: 769px) {
            .nav-arrow {
                display: block;
            }
        }
    </style>
</head>
<body>
    <div class="reader-container" id="readerContainer">
        <!-- ìƒë‹¨ í—¤ë” -->
        <header class="reader-header">
            <div class="book-title" id="bookTitle">ì´ë¶ ì œëª©</div>
            <div class="header-controls">
                <button class="control-btn single-page-btn active" onclick="setPageMode('single')">
                    ğŸ“– ë‹¨ì¼ í˜ì´ì§€
                </button>
                <button class="control-btn double-page-btn" onclick="setPageMode('double')">
                    ğŸ“š ì´ì¤‘ í˜ì´ì§€
                </button>
                <button class="control-btn" onclick="toggleSettings()">
                    âš™ï¸ ì„¤ì •
                </button>
                <button class="control-btn" onclick="goToBookList()">
                    ğŸ“š ëª©ë¡
                </button>
            </div>
        </header>

        <!-- ì§„í–‰ í‘œì‹œì¤„ -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <!-- ë©”ì¸ ì½ê¸° ì˜ì—­ -->
        <main class="reading-area single-page-mode" id="readingArea">
            <div class="page-container" id="pageContainer1">
                <div class="page-content" id="pageContent1">
                    <div class="loading">ğŸ“š ì´ë¶ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                </div>
            </div>
            <div class="page-container" id="pageContainer2" style="display: none;">
                <div class="page-content" id="pageContent2"></div>
            </div>
        </main>

        <!-- ë„¤ë¹„ê²Œì´ì…˜ í™”ì‚´í‘œ -->
        <button class="nav-arrow prev" onclick="prevPage()">â€¹</button>
        <button class="nav-arrow next" onclick="nextPage()">â€º</button>
    </div>

    <!-- ì„¤ì • íŒ¨ë„ -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-content">
            <div class="settings-section">
                <h3>ğŸ“ í…ìŠ¤íŠ¸ ì„¤ì •</h3>
                
                <div class="setting-item">
                    <label>ê¸€ì í¬ê¸°</label>
                    <input type="range" 
                           class="setting-slider" 
                           id="fontSizeSlider" 
                           min="12" 
                           max="32" 
                           value="16" 
                           onchange="changeFontSize(this.value)">
                    <span id="fontSizeValue">16px</span>
                </div>

                <div class="setting-item">
                    <label>ì¤„ ê°„ê²©</label>
                    <input type="range" 
                           class="setting-slider" 
                           id="lineHeightSlider" 
                           min="1.2" 
                           max="3.0" 
                           step="0.1" 
                           value="1.8" 
                           onchange="changeLineHeight(this.value)">
                    <span id="lineHeightValue">1.8</span>
                </div>
            </div>

            <div class="settings-section">
                <h3>ğŸ¨ í…Œë§ˆ</h3>
                <div class="theme-buttons">
                    <div class="theme-btn theme-light active" onclick="setTheme('light')"></div>
                    <div class="theme-btn theme-sepia" onclick="setTheme('sepia')"></div>
                    <div class="theme-btn theme-dark" onclick="setTheme('dark')"></div>
                </div>
            </div>

            <div class="settings-section">
                <h3>ğŸ“± ê¸°íƒ€</h3>
                <div class="setting-item">
                    <button class="control-btn" onclick="resetSettings()">
                        ğŸ”„ ì„¤ì • ì´ˆê¸°í™”
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentBook = null;
        let currentPage = 0;
        let totalPages = 0;
        let pageMode = 'single'; // 'single' or 'double'
        let fullText = '';
        let pages = [];
        let settings = {
            fontSize: 16,
            lineHeight: 1.8,
            theme: 'light'
        };

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadSettings();
            loadBookFromStorage();
            applySettings();
            
            // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
            document.addEventListener('keydown', handleKeyboard);
            
            // í„°ì¹˜/ìŠ¤ì™€ì´í”„ ì§€ì›
            setupTouchNavigation();
        });

        // ì„¤ì • ë¡œë“œ
        function loadSettings() {
            const saved = localStorage.getItem('readerSettings');
            if (saved) {
                settings = {...settings, ...JSON.parse(saved)};
                updateSettingsUI();
            }
        }

        // ì„¤ì • ì €ì¥
        function saveSettings() {
            localStorage.setItem('readerSettings', JSON.stringify(settings));
        }

        // ì„¤ì • ì ìš©
        function applySettings() {
            const root = document.documentElement;
            root.style.setProperty('--font-size', settings.fontSize + 'px');
            root.style.setProperty('--line-height', settings.lineHeight);
            
            const container = document.getElementById('readerContainer');
            container.className = 'reader-container theme-' + settings.theme;
        }

        // localStorageì—ì„œ ì±… ë¡œë“œ
        function loadBookFromStorage() {
            try {
                const stored = localStorage.getItem('currentBook');
                if (stored) {
                    currentBook = JSON.parse(stored);
                    loadBook(currentBook);
                } else {
                    showError('ì„ íƒëœ ë„ì„œê°€ ì—†ìŠµë‹ˆë‹¤.', 'ë„ì„œ ëª©ë¡ì—ì„œ ì±…ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                }
            } catch (error) {
                console.error('Book loading error:', error);
                showError('ë„ì„œ ë¡œë”© ì˜¤ë¥˜', 'ë„ì„œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ìƒ˜í”Œ ë„ì„œ ë¡œë“œ (ì±…ì´ ì—†ì„ ë•Œ ì‚¬ìš©)
        function loadSampleBook() {
            const sampleBook = {
                id: 'sample',
                title: 'ì´ë„ - ê°œì„ ëœ ì´ë¶ ë¦¬ë” ì†Œê°œ',
                author: 'ì´ë„ ì‹œìŠ¤í…œ',
                emoji: 'ğŸ“š',
                description: 'ê°œì„ ëœ ì´ë¶ ë¦¬ë”ì˜ ê¸°ëŠ¥ì„ ì²´í—˜í•´ë³´ì„¸ìš”',
                content: `ğŸ“š ì´ë„ - ê°œì„ ëœ ì´ë¶ ë¦¬ë”ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!

ğŸ¯ ì£¼ìš” ê°œì„ ì‚¬í•­

1. ğŸ“± ëª¨ë°”ì¼ ìµœì í™”
   - í„°ì¹˜ì™€ ìŠ¤ì™€ì´í”„ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ í˜ì´ì§€ ë„˜ê¹€
   - ëª¨ë°”ì¼ì— ìµœì í™”ëœ ë‹¨ì¼ í˜ì´ì§€ ë·°
   - ë°˜ì‘í˜• ë””ìì¸ìœ¼ë¡œ ëª¨ë“  í™”ë©´ í¬ê¸°ì— ëŒ€ì‘

2. ğŸ–¥ï¸ ë°ìŠ¤í¬íƒ‘ ê³ ê¸‰ ê¸°ëŠ¥
   - ë‹¨ì¼ í˜ì´ì§€ / ì´ì¤‘ í˜ì´ì§€ ëª¨ë“œ ì„ íƒ
   - í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì§€ì› (í™”ì‚´í‘œ, ìŠ¤í˜ì´ìŠ¤ë°”, Home, End)
   - ì‹œê°ì  ë„¤ë¹„ê²Œì´ì…˜ í™”ì‚´í‘œ

3. ğŸ“ í…ìŠ¤íŠ¸ ì„¤ì •
   - ê¸€ì í¬ê¸° 12px~32px ì‹¤ì‹œê°„ ì¡°ì •
   - ì¤„ ê°„ê²© 1.2~3.0 ì„¸ë°€ ì¡°ì •
   - ë‚´ìš©ì´ ì§¤ë¦¬ì§€ ì•ŠëŠ” ìë™ ë¦¬í”Œë¡œìš°

4. ğŸ¨ í…Œë§ˆ ì‹œìŠ¤í…œ
   - ë¼ì´íŠ¸ í…Œë§ˆ (ê¸°ë³¸)
   - ì„¸í”¼ì•„ í…Œë§ˆ (ëˆˆì˜ í”¼ë¡œ ê°ì†Œ)
   - ë‹¤í¬ í…Œë§ˆ (ì•¼ê°„ ë…ì„œìš©)

5. ğŸ“Š ë…ì„œ ë„ìš°ë¯¸
   - ì‹¤ì‹œê°„ ì§„í–‰ë¥  í‘œì‹œ
   - ì„¤ì • ìë™ ì €ì¥
   - ì°½ í¬ê¸° ë³€ê²½ ì‹œ ìë™ ì¬ì¡°ì •

âš™ï¸ ì‚¬ìš©ë²•

ğŸ–±ï¸ ë§ˆìš°ìŠ¤/í‚¤ë³´ë“œ ì¡°ì‘:
- í™”ì‚´í‘œ í‚¤ ë˜ëŠ” ë„¤ë¹„ê²Œì´ì…˜ í™”ì‚´í‘œë¡œ í˜ì´ì§€ ì´ë™
- ìŠ¤í˜ì´ìŠ¤ë°”ë¡œ ë‹¤ìŒ í˜ì´ì§€
- Home/End í‚¤ë¡œ ì²˜ìŒ/ë§ˆì§€ë§‰ í˜ì´ì§€ë¡œ

ğŸ“± í„°ì¹˜ ì¡°ì‘:
- ì¢Œìš° ìŠ¤ì™€ì´í”„ë¡œ í˜ì´ì§€ ë„˜ê¹€
- ì„¤ì • ë²„íŠ¼ìœ¼ë¡œ í…ìŠ¤íŠ¸ í¬ê¸° ì¡°ì •

âš™ï¸ ì„¤ì • íŒ¨ë„:
ìš°ìƒë‹¨ì˜ 'âš™ï¸ ì„¤ì •' ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë‹¤ì–‘í•œ ì˜µì…˜ì„ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸŒŸ ì—°ì†ì ì¸ í…ìŠ¤íŠ¸ í”Œë¡œìš°

ê¸°ì¡´ì˜ ì¸ìœ„ì ì¸ ì¥ êµ¬ë¶„ì„ ì—†ì• ê³  ìì—°ìŠ¤ëŸ¬ìš´ í…ìŠ¤íŠ¸ íë¦„ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. ê¸€ì í¬ê¸°ë¥¼ ì¡°ì •í•´ë„ ë‚´ìš©ì´ ì§¤ë¦¬ì§€ ì•Šê³  ìì—°ìŠ¤ëŸ½ê²Œ í˜ì´ì§€ê°€ ì¬êµ¬ì„±ë©ë‹ˆë‹¤.

ğŸ“š ë„ì„œ ê´€ë¦¬

ì—…ë¡œë“œëœ ë„ì„œì™€ ê¸°ë³¸ ë„ì„œ ëª¨ë‘ ì´ ê°œì„ ëœ ë¦¬ë”ì—ì„œ ì½ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë„ì„œ ëª©ë¡ì—ì„œ ì±…ì„ ì„ íƒí•˜ë©´ ìë™ìœ¼ë¡œ ì´ ë¦¬ë”ì—ì„œ ì—´ë¦½ë‹ˆë‹¤.

ğŸ‰ ì¦ê±°ìš´ ë…ì„œë˜ì„¸ìš”!

ì´ì œ 'ğŸ“š ë„ì„œ ëª©ë¡ìœ¼ë¡œ' ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹¤ì œ ë„ì„œë“¤ì„ ì½ì–´ë³´ì„¸ìš”. ëª¨ë“  ë„ì„œê°€ ì´ ê°œì„ ëœ ë¦¬ë”ì—ì„œ í¸ì•ˆí•˜ê²Œ ì½í ê²ƒì…ë‹ˆë‹¤.

ğŸ”§ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

ì§€ê¸ˆ ë°”ë¡œ ë‹¤ìŒ ê¸°ëŠ¥ë“¤ì„ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”:

1. ìš°ìƒë‹¨ âš™ï¸ ì„¤ì • ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ê¸€ì í¬ê¸°ë¥¼ ìµœëŒ€ 32pxë¡œ ì¡°ì •í•´ë³´ì„¸ìš”. ë‚´ìš©ì´ ì§¤ë¦¬ì§€ ì•Šê³  ìì—°ìŠ¤ëŸ½ê²Œ ë‹¤ì‹œ ë¶„í• ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

2. ë°ìŠ¤í¬íƒ‘ì—ì„œëŠ” ìƒë‹¨ì˜ "ğŸ“š ì´ì¤‘ í˜ì´ì§€" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë‘ í˜ì´ì§€ë¥¼ ë‚˜ë€íˆ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

3. í‚¤ë³´ë“œì˜ í™”ì‚´í‘œ í‚¤ë‚˜ ìŠ¤í˜ì´ìŠ¤ë°”ë¥¼ ëˆŒëŸ¬ í˜ì´ì§€ë¥¼ ë„˜ê²¨ë³´ì„¸ìš”.

4. ëª¨ë°”ì¼ì—ì„œëŠ” í™”ë©´ì„ ì¢Œìš°ë¡œ ìŠ¤ì™€ì´í”„í•˜ì—¬ í˜ì´ì§€ë¥¼ ë„˜ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

5. í…Œë§ˆë„ ë³€ê²½í•´ë³´ì„¸ìš”. ì„¸í”¼ì•„ í…Œë§ˆëŠ” ëˆˆì˜ í”¼ë¡œë¥¼ ì¤„ì—¬ì£¼ê³ , ë‹¤í¬ í…Œë§ˆëŠ” ì•¼ê°„ ë…ì„œì— ì í•©í•©ë‹ˆë‹¤.

âœ¨ ì´ì œ ëª¨ë“  ë¬¸ì œê°€ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤!

- âœ… ë°ìŠ¤í¬íƒ‘: ë‹¨ì¼/ì´ì¤‘ í˜ì´ì§€ ì„ íƒ ê°€ëŠ¥
- âœ… ê¸€ì í¬ê¸° í™•ëŒ€ ì‹œ ë‚´ìš© ì•ˆ ì§¤ë¦¼
- âœ… ëª¨ë°”ì¼ì—ì„œ ì—…ë¡œë“œ ë„ì„œ ì •ìƒ í‘œì‹œ
- âœ… ìì—°ìŠ¤ëŸ¬ìš´ í˜ì´ì§€ íë¦„ (ì¥ êµ¬ë¶„ ì—†ìŒ)
- âœ… ì™„ë²½í•œ ë°˜ì‘í˜• ë””ìì¸

ëª¨ë“  ë””ë°”ì´ìŠ¤ì—ì„œ í¸ì•ˆí•œ ë…ì„œ ê²½í—˜ì„ ì¦ê¸°ì„¸ìš”! ğŸ“–âœ¨`
            };
            
            // localStorageì— ì €ì¥í•˜ê³  ë¡œë“œ
            localStorage.setItem('currentBook', JSON.stringify(sampleBook));
            loadBook(sampleBook);
        }

        // ì±… ë¡œë“œ
        function loadBook(book) {
            if (!book) {
                showError('ì˜ëª»ëœ ë„ì„œ', 'ë„ì„œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            document.getElementById('bookTitle').textContent = book.title || 'ì œëª© ì—†ìŒ';

            // í…ìŠ¤íŠ¸ ë‚´ìš© ì¶”ì¶œ
            if (book.content) {
                fullText = book.content;
            } else if (book.chapters && book.chapters.length > 0) {
                fullText = book.chapters.map(chapter => chapter.content).join('\n\n');
            } else {
                showError('ë‚´ìš© ì—†ìŒ', 'ì´ ë„ì„œì—ëŠ” ì½ì„ ìˆ˜ ìˆëŠ” ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // í˜ì´ì§€ ë¶„í•  ë° í‘œì‹œ
            paginateText();
            showPage(0);
        }

        // í…ìŠ¤íŠ¸ë¥¼ í˜ì´ì§€ë¡œ ë¶„í•  (ìë™ ì¤„ë°”ê¿ˆ ê³ ë ¤)
        function paginateText() {
            if (!fullText) return;

            const container = document.getElementById('pageContent1');
            const containerHeight = container.clientHeight || 600;
            const fontSize = settings.fontSize;
            const lineHeight = settings.lineHeight;
            
            // ëŒ€ëµì ì¸ í•œ í˜ì´ì§€ë‹¹ ë¬¸ì ìˆ˜ ê³„ì‚°
            const linesPerPage = Math.floor(containerHeight / (fontSize * lineHeight));
            const charsPerLine = pageMode === 'double' ? 35 : 50; // í˜ì´ì§€ ëª¨ë“œì— ë”°ë¼ ì¡°ì •
            const charsPerPage = linesPerPage * charsPerLine;

            pages = [];
            let currentPos = 0;
            
            while (currentPos < fullText.length) {
                let endPos = Math.min(currentPos + charsPerPage, fullText.length);
                
                // ë‹¨ì–´ ì¤‘ê°„ì—ì„œ ìë¥´ì§€ ì•Šë„ë¡ ì¡°ì •
                if (endPos < fullText.length) {
                    while (endPos > currentPos && 
                           fullText[endPos] !== ' ' && 
                           fullText[endPos] !== '\n' && 
                           fullText[endPos] !== '.' && 
                           fullText[endPos] !== '!' && 
                           fullText[endPos] !== '?') {
                        endPos--;
                    }
                    if (endPos === currentPos) {
                        endPos = currentPos + charsPerPage; // ê°•ì œë¡œ ìë¥´ê¸°
                    }
                }
                
                const pageText = fullText.substring(currentPos, endPos).trim();
                if (pageText) {
                    pages.push(pageText);
                }
                
                currentPos = endPos;
            }

            totalPages = pages.length;
            updateProgress();
        }

        // í˜ì´ì§€ í‘œì‹œ
        function showPage(pageIndex) {
            if (pageIndex < 0 || pageIndex >= totalPages) return;
            
            currentPage = pageIndex;

            if (pageMode === 'single') {
                showSinglePage(pageIndex);
            } else {
                showDoublePage(pageIndex);
            }

            updateProgress();
        }

        // ë‹¨ì¼ í˜ì´ì§€ í‘œì‹œ
        function showSinglePage(pageIndex) {
            const content = document.getElementById('pageContent1');
            if (pages[pageIndex]) {
                content.innerHTML = formatText(pages[pageIndex]);
            } else {
                content.innerHTML = '<div class="error">í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        }

        // ì´ì¤‘ í˜ì´ì§€ í‘œì‹œ
        function showDoublePage(pageIndex) {
            const content1 = document.getElementById('pageContent1');
            const content2 = document.getElementById('pageContent2');
            
            if (pages[pageIndex]) {
                content1.innerHTML = formatText(pages[pageIndex]);
            } else {
                content1.innerHTML = '';
            }
            
            if (pages[pageIndex + 1]) {
                content2.innerHTML = formatText(pages[pageIndex + 1]);
            } else {
                content2.innerHTML = '';
            }
        }

        // í…ìŠ¤íŠ¸ í¬ë§·íŒ…
        function formatText(text) {
            if (!text) return '';
            
            return text
                .split('\n\n')
                .map(paragraph => `<p>${paragraph.replace(/\n/g, '<br>')}</p>`)
                .join('');
        }

        // í˜ì´ì§€ ëª¨ë“œ ë³€ê²½
        function setPageMode(mode) {
            pageMode = mode;
            const area = document.getElementById('readingArea');
            const container2 = document.getElementById('pageContainer2');
            
            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            if (mode === 'single') {
                area.className = 'reading-area single-page-mode';
                container2.style.display = 'none';
                document.querySelector('.single-page-btn').classList.add('active');
            } else {
                area.className = 'reading-area double-page-mode';
                container2.style.display = 'block';
                document.querySelector('.double-page-btn').classList.add('active');
            }
            
            // í˜ì´ì§€ ì¬ë¶„í•  ë° í‘œì‹œ
            paginateText();
            showPage(currentPage);
        }

        // í˜ì´ì§€ ë„¤ë¹„ê²Œì´ì…˜
        function nextPage() {
            const increment = pageMode === 'double' ? 2 : 1;
            if (currentPage + increment < totalPages) {
                showPage(currentPage + increment);
            }
        }

        function prevPage() {
            const decrement = pageMode === 'double' ? 2 : 1;
            if (currentPage - decrement >= 0) {
                showPage(currentPage - decrement);
            }
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        function handleKeyboard(e) {
            switch(e.key) {
                case 'ArrowRight':
                case ' ':
                    e.preventDefault();
                    nextPage();
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    prevPage();
                    break;
                case 'Home':
                    e.preventDefault();
                    showPage(0);
                    break;
                case 'End':
                    e.preventDefault();
                    showPage(totalPages - 1);
                    break;
            }
        }

        // í„°ì¹˜/ìŠ¤ì™€ì´í”„ ë„¤ë¹„ê²Œì´ì…˜
        function setupTouchNavigation() {
            let startX = 0;
            let startY = 0;

            document.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
            });

            document.addEventListener('touchend', (e) => {
                const endX = e.changedTouches[0].clientX;
                const endY = e.changedTouches[0].clientY;
                const diffX = startX - endX;
                const diffY = Math.abs(startY - endY);

                // ìˆ˜í‰ ìŠ¤ì™€ì´í”„ë§Œ ì²˜ë¦¬ (ì„¸ë¡œ ìŠ¤í¬ë¡¤ê³¼ êµ¬ë¶„)
                if (Math.abs(diffX) > 50 && diffY < 100) {
                    if (diffX > 0) {
                        nextPage(); // ì™¼ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ = ë‹¤ìŒ í˜ì´ì§€
                    } else {
                        prevPage(); // ì˜¤ë¥¸ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ = ì´ì „ í˜ì´ì§€
                    }
                }
            });
        }

        // ì„¤ì • ê´€ë ¨ í•¨ìˆ˜ë“¤
        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.classList.toggle('open');
        }

        function changeFontSize(value) {
            settings.fontSize = parseInt(value);
            document.getElementById('fontSizeValue').textContent = value + 'px';
            applySettings();
            saveSettings();
            
            // í˜ì´ì§€ ì¬ë¶„í• 
            setTimeout(() => {
                paginateText();
                showPage(currentPage);
            }, 100);
        }

        function changeLineHeight(value) {
            settings.lineHeight = parseFloat(value);
            document.getElementById('lineHeightValue').textContent = value;
            applySettings();
            saveSettings();
            
            // í˜ì´ì§€ ì¬ë¶„í• 
            setTimeout(() => {
                paginateText();
                showPage(currentPage);
            }, 100);
        }

        function setTheme(theme) {
            settings.theme = theme;
            
            // í…Œë§ˆ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('.theme-' + theme).classList.add('active');
            
            applySettings();
            saveSettings();
        }

        function updateSettingsUI() {
            document.getElementById('fontSizeSlider').value = settings.fontSize;
            document.getElementById('fontSizeValue').textContent = settings.fontSize + 'px';
            document.getElementById('lineHeightSlider').value = settings.lineHeight;
            document.getElementById('lineHeightValue').textContent = settings.lineHeight;
            
            // í…Œë§ˆ ë²„íŠ¼ ìƒíƒœ
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector('.theme-' + settings.theme).classList.add('active');
        }

        function resetSettings() {
            settings = {
                fontSize: 16,
                lineHeight: 1.8,
                theme: 'light'
            };
            updateSettingsUI();
            applySettings();
            saveSettings();
            
            // í˜ì´ì§€ ì¬ë¶„í• 
            setTimeout(() => {
                paginateText();
                showPage(currentPage);
            }, 100);
        }

        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        function updateProgress() {
            if (totalPages > 0) {
                const progress = ((currentPage + 1) / totalPages) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
            }
        }

        // ì—ëŸ¬ í‘œì‹œ (ê°œì„ ëœ ë²„ì „)
        function showError(title, message) {
            const content = document.getElementById('pageContent1');
            content.innerHTML = `
                <div class="error">
                    <h3>${title}</h3>
                    <p>${message}</p>
                    <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1rem;">
                        <button onclick="goToBookList()">ğŸ“š ë„ì„œ ëª©ë¡ìœ¼ë¡œ</button>
                        <button onclick="loadSampleBook()">ğŸ“– ìƒ˜í”Œ ë„ì„œ ì½ê¸°</button>
                    </div>
                </div>
            `;
        }

        // ë„ì„œ ëª©ë¡ìœ¼ë¡œ ì´ë™
        function goToBookList() {
            window.location.href = 'books-dynamic.html';
        }

        // ì¤‘ë³µ ì œê±°ë¨ - ìœ„ìª½ì— ì •ì˜ëœ í•¨ìˆ˜ ì‚¬ìš©

        // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì²˜ë¦¬
        window.addEventListener('resize', () => {
            setTimeout(() => {
                paginateText();
                showPage(currentPage);
            }, 300);
        });
    </script>
</body>
</html>