<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î≤îÏö© Î¶¨ÎçîÍ∏∞ - Ïù¥ÎèÑ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nanum Myeongjo', 'Times New Roman', serif;
            line-height: 1.8;
            background: #f8f9fa;
            transition: all 0.3s ease;
            user-select: text;
        }

        body.dark-mode {
            background: #1a1a1a;
            color: #e2e8f0;
        }

        .reader-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
        }

        .reader-header h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .reader-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .control-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .reader-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 100px 2rem 2rem;
            min-height: 100vh;
        }

        .book-info {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            text-align: center;
        }

        .dark-mode .book-info {
            background: #2d2d2d;
            color: #e2e8f0;
        }

        .book-emoji {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .book-title {
            font-size: 2rem;
            color: #2563eb;
            margin-bottom: 0.5rem;
        }

        .dark-mode .book-title {
            color: #60a5fa;
        }

        .book-author {
            color: #64748b;
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        .book-description {
            color: #475569;
            line-height: 1.6;
        }

        .dark-mode .book-description {
            color: #94a3b8;
        }

        .language-selector {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .lang-btn {
            background: #f1f5f9;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .lang-btn.active {
            background: #2563eb;
            color: white;
        }

        .dark-mode .lang-btn {
            background: #374151;
            color: #d1d5db;
        }

        .dark-mode .lang-btn.active {
            background: #3b82f6;
        }

        .content-area {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            min-height: 400px;
        }

        .dark-mode .content-area {
            background: #2d2d2d;
            color: #e2e8f0;
        }

        .chapter-content {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #1e293b;
            white-space: pre-wrap;
        }

        .dark-mode .chapter-content {
            color: #e2e8f0;
        }

        .chapter-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 2rem 0;
            padding: 1rem;
            background: white;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .dark-mode .chapter-nav {
            background: #2d2d2d;
        }

        .nav-btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .nav-btn:hover:not(:disabled) {
            background: #1d4ed8;
            transform: translateY(-1px);
        }

        .nav-btn:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }

        .chapter-info {
            font-weight: 600;
            color: #475569;
        }

        .dark-mode .chapter-info {
            color: #94a3b8;
        }

        .error-message {
            background: #fef2f2;
            color: #991b1b;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            margin: 2rem 0;
        }

        .dark-mode .error-message {
            background: #431c1c;
            color: #fca5a5;
        }

        .loading-message {
            background: #eff6ff;
            color: #1d4ed8;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            margin: 2rem 0;
        }

        .dark-mode .loading-message {
            background: #1e293b;
            color: #60a5fa;
        }

        .settings-panel {
            position: fixed;
            top: 70px;
            right: -300px;
            width: 300px;
            height: calc(100vh - 70px);
            background: white;
            box-shadow: -2px 0 20px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            padding: 2rem;
            overflow-y: auto;
            z-index: 999;
        }

        .settings-panel.open {
            right: 0;
        }

        .dark-mode .settings-panel {
            background: #2d2d2d;
            color: #e2e8f0;
        }

        .setting-group {
            margin-bottom: 2rem;
        }

        .setting-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .setting-slider {
            width: 100%;
            margin: 0.5rem 0;
        }

        .back-btn {
            background: #6b7280;
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .back-btn:hover {
            background: #4b5563;
        }

        @media (max-width: 768px) {
            .reader-container {
                padding: 90px 1rem 1rem;
            }
            
            .reader-header h1 {
                font-size: 1.2rem;
            }
            
            .settings-panel {
                width: 250px;
            }
        }
    </style>
</head>
<body>
    <header class="reader-header">
        <h1 id="bookTitle">Î≤îÏö© Î¶¨ÎçîÍ∏∞</h1>
        <div class="reader-controls">
            <a href="books-dynamic.html" class="back-btn">‚Üê Î™©Î°ù</a>
            <button class="control-btn" onclick="toggleSettings()">‚öôÔ∏è ÏÑ§Ï†ï</button>
            <button class="control-btn" onclick="toggleDarkMode()">üåô Îã§ÌÅ¨Î™®Îìú</button>
        </div>
    </header>

    <div class="reader-container">
        <div class="loading-message" id="loadingMessage">
            üìñ ÎèÑÏÑúÎ•º Î∂àÎü¨Ïò§Îäî Ï§ë...
        </div>

        <div class="error-message" id="errorMessage" style="display: none;">
            ‚ùå ÎèÑÏÑúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.
        </div>

        <div id="bookContent" style="display: none;">
            <div class="book-info">
                <div class="book-emoji" id="bookEmoji">üìñ</div>
                <h2 class="book-title" id="displayTitle">ÎèÑÏÑú Ï†úÎ™©</h2>
                <p class="book-author" id="displayAuthor">ÏûëÍ∞Ä Ïù¥Î¶Ñ</p>
                <p class="book-description" id="displayDescription">ÎèÑÏÑú ÏÑ§Î™Ö</p>
            </div>

            <div class="language-selector" id="languageSelector">
                <!-- ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ± -->
            </div>

            <div class="content-area">
                <div class="chapter-content" id="chapterContent">
                    ÎÇ¥Ïö©ÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë...
                </div>
            </div>

            <div class="chapter-nav">
                <button class="nav-btn" id="prevBtn" onclick="previousChapter()">‚Üê Ïù¥Ï†Ñ</button>
                <span class="chapter-info" id="chapterInfo">Chapter 1 / 1</span>
                <button class="nav-btn" id="nextBtn" onclick="nextChapter()">Îã§Ïùå ‚Üí</button>
            </div>
        </div>
    </div>

    <!-- ÏÑ§Ï†ï Ìå®ÎÑê -->
    <div class="settings-panel" id="settingsPanel">
        <h3>ÏùΩÍ∏∞ ÏÑ§Ï†ï</h3>
        
        <div class="setting-group">
            <label class="setting-label">Í∏ÄÏûê ÌÅ¨Í∏∞</label>
            <input type="range" class="setting-slider" id="fontSizeSlider" min="14" max="24" value="18" onchange="changeFontSize(this.value)">
            <span id="fontSizeValue">18px</span>
        </div>
        
        <div class="setting-group">
            <label class="setting-label">Ï§Ñ Í∞ÑÍ≤©</label>
            <input type="range" class="setting-slider" id="lineHeightSlider" min="1.4" max="2.2" step="0.1" value="1.8" onchange="changeLineHeight(this.value)">
            <span id="lineHeightValue">1.8</span>
        </div>
        
        <div class="setting-group">
            <button class="nav-btn" onclick="resetSettings()" style="width: 100%; margin-top: 1rem;">Í∏∞Î≥∏Í∞í Î≥µÏõê</button>
        </div>
    </div>

    <script>
        let currentBook = null;
        let currentLanguage = 'korean';
        let currentChapter = 0;
        let chapters = [];

        // URL ÌååÎùºÎØ∏ÌÑ∞ÏóêÏÑú ÎèÑÏÑú IDÏôÄ Ïñ∏Ïñ¥ Ï†ïÎ≥¥ Í∞ÄÏ†∏Ïò§Í∏∞
        function getUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            return {
                bookId: urlParams.get('book'),
                language: urlParams.get('lang') || 'korean'
            };
        }

        // ÎèÑÏÑú Î°úÎìú
        function loadBook() {
            const params = getUrlParams();
            if (!params.bookId) {
                showError('ÎèÑÏÑú IDÍ∞Ä ÏßÄÏ†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.');
                return;
            }

            const testBooks = JSON.parse(localStorage.getItem('testBooks') || '[]');
            currentBook = testBooks.find(book => book.id === params.bookId);
            
            if (!currentBook) {
                showError(`ÎèÑÏÑú "${params.bookId}"Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.`);
                return;
            }

            currentLanguage = params.language;
            displayBook();
        }

        // ÎèÑÏÑú ÌëúÏãú
        function displayBook() {
            document.getElementById('loadingMessage').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('bookContent').style.display = 'block';

            // ÎèÑÏÑú Ï†ïÎ≥¥ ÌëúÏãú
            document.getElementById('bookTitle').textContent = currentBook.title[currentLanguage] || currentBook.title.korean || 'Ï†úÎ™© ÏóÜÏùå';
            document.getElementById('bookEmoji').textContent = currentBook.emoji || 'üìñ';
            document.getElementById('displayTitle').textContent = currentBook.title[currentLanguage] || currentBook.title.korean || 'Ï†úÎ™© ÏóÜÏùå';
            document.getElementById('displayAuthor').textContent = currentBook.author[currentLanguage] || currentBook.author.korean || 'ÏûëÍ∞Ä ÎØ∏ÏÉÅ';
            document.getElementById('displayDescription').textContent = currentBook.description[currentLanguage] || currentBook.description.korean || 'ÏÑ§Î™Ö ÏóÜÏùå';

            // Ïñ∏Ïñ¥ ÏÑ†ÌÉùÍ∏∞ ÏÉùÏÑ±
            createLanguageSelector();

            // Ï±ïÌÑ∞ ÌååÏã± Î∞è ÌëúÏãú
            parseChapters();
            displayChapter();
        }

        // Ïñ∏Ïñ¥ ÏÑ†ÌÉùÍ∏∞ ÏÉùÏÑ±
        function createLanguageSelector() {
            const selector = document.getElementById('languageSelector');
            selector.innerHTML = '';

            const languages = {
                korean: 'üá∞üá∑ ÌïúÍµ≠Ïñ¥',
                english: 'üá∫üá∏ English',
                spanish: 'üá™üá∏ Espa√±ol',
                japanese: 'üáØüáµ Êó•Êú¨Ë™û'
            };

            Object.keys(languages).forEach(lang => {
                if (currentBook.title[lang] && currentBook.content[lang]) {
                    const btn = document.createElement('button');
                    btn.className = 'lang-btn';
                    btn.textContent = languages[lang];
                    if (lang === currentLanguage) btn.classList.add('active');
                    btn.onclick = () => changeLanguage(lang);
                    selector.appendChild(btn);
                }
            });
        }

        // Ïñ∏Ïñ¥ Î≥ÄÍ≤Ω
        function changeLanguage(language) {
            currentLanguage = language;
            currentChapter = 0;
            
            // Ïñ∏Ïñ¥ Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // ÎèÑÏÑú Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('bookTitle').textContent = currentBook.title[currentLanguage] || currentBook.title.korean;
            document.getElementById('displayTitle').textContent = currentBook.title[currentLanguage] || currentBook.title.korean;
            document.getElementById('displayAuthor').textContent = currentBook.author[currentLanguage] || currentBook.author.korean;
            document.getElementById('displayDescription').textContent = currentBook.description[currentLanguage] || currentBook.description.korean;
            
            // Ï±ïÌÑ∞ Ïû¨ÌååÏã± Î∞è ÌëúÏãú
            parseChapters();
            displayChapter();
        }

        // Ï±ïÌÑ∞ ÌååÏã±
        function parseChapters() {
            const content = currentBook.content[currentLanguage] || '';
            
            if (currentBook.chapters && currentBook.chapters.length > 0) {
                // Ïù¥ÎØ∏ ÌååÏã±Îêú Ï±ïÌÑ∞Í∞Ä ÏûàÎäî Í≤ΩÏö∞
                chapters = currentBook.chapters.map(chapter => chapter[currentLanguage] || chapter.korean || 'ÎÇ¥Ïö© ÏóÜÏùå');
            } else {
                // ÎÇ¥Ïö©ÏùÑ Ï±ïÌÑ∞Î°ú Î∂ÑÌï†
                const chapterRegex = /(?:Chapter\s+\d+|Ï†ú\s*\d+\s*Ïû•|Á¨¨\s*\d+\s*Á´†|Cap√≠tulo\s+\d+)/gi;
                const parts = content.split(chapterRegex);
                
                if (parts.length > 1) {
                    chapters = parts.slice(1).filter(part => part.trim()).map(part => part.trim());
                } else {
                    chapters = [content.trim()];
                }
            }
            
            if (chapters.length === 0) {
                chapters = ['ÎÇ¥Ïö©Ïù¥ ÏóÜÏäµÎãàÎã§.'];
            }
        }

        // Ï±ïÌÑ∞ ÌëúÏãú
        function displayChapter() {
            if (chapters.length === 0) return;
            
            document.getElementById('chapterContent').textContent = chapters[currentChapter] || 'ÎÇ¥Ïö©Ïù¥ ÏóÜÏäµÎãàÎã§.';
            document.getElementById('chapterInfo').textContent = `Chapter ${currentChapter + 1} / ${chapters.length}`;
            
            // ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò Î≤ÑÌäº ÏÉÅÌÉú
            document.getElementById('prevBtn').disabled = currentChapter === 0;
            document.getElementById('nextBtn').disabled = currentChapter === chapters.length - 1;
        }

        // Ïù¥Ï†Ñ Ï±ïÌÑ∞
        function previousChapter() {
            if (currentChapter > 0) {
                currentChapter--;
                displayChapter();
                window.scrollTo(0, 0);
            }
        }

        // Îã§Ïùå Ï±ïÌÑ∞
        function nextChapter() {
            if (currentChapter < chapters.length - 1) {
                currentChapter++;
                displayChapter();
                window.scrollTo(0, 0);
            }
        }

        // Ïò§Î•ò ÌëúÏãú
        function showError(message) {
            document.getElementById('loadingMessage').style.display = 'none';
            document.getElementById('errorMessage').textContent = '‚ùå ' + message;
            document.getElementById('errorMessage').style.display = 'block';
        }

        // ÏÑ§Ï†ï Ìå®ÎÑê ÌÜ†Í∏Ä
        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.classList.toggle('open');
        }

        // Îã§ÌÅ¨Î™®Îìú ÌÜ†Í∏Ä
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        }

        // Í∏ÄÏûê ÌÅ¨Í∏∞ Î≥ÄÍ≤Ω
        function changeFontSize(size) {
            document.getElementById('chapterContent').style.fontSize = size + 'px';
            document.getElementById('fontSizeValue').textContent = size + 'px';
            localStorage.setItem('fontSize', size);
        }

        // Ï§Ñ Í∞ÑÍ≤© Î≥ÄÍ≤Ω
        function changeLineHeight(height) {
            document.getElementById('chapterContent').style.lineHeight = height;
            document.getElementById('lineHeightValue').textContent = height;
            localStorage.setItem('lineHeight', height);
        }

        // ÏÑ§Ï†ï Ï¥àÍ∏∞Ìôî
        function resetSettings() {
            changeFontSize(18);
            changeLineHeight(1.8);
            document.getElementById('fontSizeSlider').value = 18;
            document.getElementById('lineHeightSlider').value = 1.8;
        }

        // ÌÇ§Î≥¥Îìú Îã®Ï∂ïÌÇ§
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowLeft') previousChapter();
            if (e.key === 'ArrowRight') nextChapter();
            if (e.key === 'Escape') toggleSettings();
        });

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            // Ï†ÄÏû•Îêú ÏÑ§Ï†ï Ï†ÅÏö©
            const savedFontSize = localStorage.getItem('fontSize') || '18';
            const savedLineHeight = localStorage.getItem('lineHeight') || '1.8';
            const savedDarkMode = localStorage.getItem('darkMode') === 'true';
            
            if (savedDarkMode) {
                document.body.classList.add('dark-mode');
            }
            
            changeFontSize(savedFontSize);
            changeLineHeight(savedLineHeight);
            document.getElementById('fontSizeSlider').value = savedFontSize;
            document.getElementById('lineHeightSlider').value = savedLineHeight;
            
            // ÎèÑÏÑú Î°úÎìú
            loadBook();
        });
    </script>
</body>
</html>